{% extends "base.jinja" %}

{% block title %}Informed Consent - Study{% endblock %}

{% block additional_styles %}
.consent-card {
    background: #f8f9fa;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: left;
    max-width: 800px;
    margin: 20px auto;
    font-size: 0.75em;
}
.consent-card h1 {
    text-align: center;
    margin-bottom: 30px;
    color: #333;
}
.consent-card h2 {
    color: #333;
    margin-top: 30px;
    margin-bottom: 15px;
    font-size: 1.3em;
}
.consent-card h3 {
    color: #333;
    margin-top: 25px;
    margin-bottom: 10px;
    font-size: 1.1em;
}
.consent-card p {
    margin-bottom: 15px;
    line-height: 1.6;
}
.consent-card ul {
    margin: 10px 0 15px 20px;
}
.consent-card ol {
    margin: 10px 0 15px 20px;
}
.consent-card li {
    margin-bottom: 8px;
}
.consent-checkbox {
    margin: 40px 0;
    padding: 20px;
    background: #fff;
    border: 2px solid #ddd;
    border-radius: 5px;
    text-align: center;
}
.consent-checkbox label {
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.consent-checkbox input[type="checkbox"] {
    transform: scale(1.5);
}
.consent-btn {
    background: #00883A;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 5px;
    font-size: 1.1em;
    cursor: pointer;
    text-decoration: none;
    display: block;
    margin: 30px auto 0 auto;
    width: fit-content;
}
.consent-btn:hover {
    background: #006B2E;
}
.consent-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}
.participant-id {
    text-align: center;
    margin-bottom: 20px;
}
.researchers {
    margin-left: 20px;
}
{% endblock %}

{% block content %}
<div class="consent-card">
    <h1>Informed Consent of Participation</h1>
    
    <div class="participant-id">Participant ID: <span class="participant-highlight">{{ participant_id }}</span></div>
    
    <p>You are invited to participate in the online study <strong>{{ study_title }}</strong>, initiated and conducted by {{ researchers_names }}, and {{ pi_name }}. The research is supervised by {{ pi_name }} at the {{ institution }}. Please note:</p>
    
    <ul>
        <li>Your participation is voluntary.</li>
        <li>The online study will last approximately {{ duration }}.</li>
        <li>We will record personal demographics ({{ personal_data }}).</li>
        {% if consent_data.record.screenrecoding %}
        <li>We will record the screen of the study environment for the duration of the study</li>
        {% endif %}
        {% if consent_data.record.interaction %}
        <li>We will record interaction data (e.g., clicks, timings) during the session.</li>
        {% endif %}
        <li>You will receive {{ compensation }} as compensation.</li>
        <li>We may publish results from this and other sessions.</li>
    </ul>
    
    <p>If you have any questions about the whole informed consent process of this research or your rights as a human research subject, please contact {{ pi_name }} (E-Mail: {{ pi_email }}). You should carefully read the settings below. You may take as much time as you need to read the consent form. If you do not fully agree with something, or if your questions have not all been answered to your satisfaction, then you should not give your consent.</p>
    
    <h2>1. Purpose and Goal of this Research</h2>
    <p>{{ purpose }} {{ goal }} Your participation will help us achieve this goal. The results of this research may be presented at scientific or professional meetings or published in scientific proceedings and journals.</p>
    
    <h2>2. Participation and Compensation</h2>
    <p>Your participation in this online study is voluntary. You will be one of approximately {{ participants }} people being surveyed for this research. You will receive {{ compensation }} as compensation for your participation. You may withdraw and discontinue participation at any time without penalty or losing the compensation. If possible, you may refuse to answer any questions you do not want to answer or withdraw from participation at any time.</p>
    
    <p>At any time and without giving any reason, you can notify us that you want to withdraw the consent given (GDPR Art. 21). In case of withdrawal, your data stored based on your consent will be deleted or anonymized where this is legally permissible (GDPR Art. 17). If deletion is impossible or only possible with unreasonable technical effort, your data will be anonymized by deleting the personal identification information. However, anonymization of your data cannot entirely exclude the possibility of subsequent tracing of information to you via other sources. Finally, once the data is anonymized, the deletion of the data is not possible anymore as we will not be able to identify which data is yours.</p>
    
    <h2>3. Procedure</h2>
    <p>This is a longitudinal study, and your participation will involve two sessions over the period of one week. 
    After giving consent, you will be guided through the following steps for the first session:</p>
    <ol>
        {% for step in procedure_steps1 %}
        <li>{{ step }}</li>
        {% endfor %}
    </ol>
    <p>After completing the first session, you will have a break of seven days before the second session begins and you will be guided through the following steps again:</p>
    <ol>
        {% for step in procedure_steps2 %}
        <li>{{ step }}</li>
        {% endfor %}
    </ol>
    <p>The complete procedure of this online study will last approximately {{ duration }}.</p>
    
    <h2>4. Risks and Benefits</h2>
    <p>There are no risks associated with this online study. Discomforts or inconveniences will be minor and are unlikely to happen. If you feel uncomfortable, you may discontinue your participation. Your benefit in participating is your compensation described above. With this research, we will advance knowledge in this research field.</p>
    
    <h2>5. Data Protection and Confidentiality</h2>
    <p>The General Data Protection Regulation (GDPR) of the European Union (EU) governs that data collection process. The legal basis for processing the personal data is the consent in accordance with GDPR Art. 6 (1). The GDPR guarantees a set of right to the data subjects, including the right to access, rectification, and erasure of personal data.</p>
    
    <ul>
        <li>You have the right to access your personal data at any time (GDPR Art. 15).</li>
        <li>You have the right to correct inaccurate personal data at any time (GDPR Art. 16).</li>
        <li>You have the right to have your personal data deleted (GDPR Art. 17).</li>
        <li>You have the right to limit the processing of your personal data (GDPR Art. 18).</li>
        <li>You have the right to have your data transferred to others (GDPR Art. 20).</li>
        <li>You have the right to withdraw the consent given (GDPR Art. 21).</li>
    </ul>
    <p>If you wish to exercise any of your rights, please contact the researchers.</p>
    
    <p>Personal data ({{ personal_data }}) will be recorded during participation. Researchers will not identify you by your real name in any reports using settings obtained from this online study, and your confidentiality as a participant in this online study will remain secure. Data collected in this online study will be treated in compliance with the GDPR.</p>
    
    <p>We will record {% if consent_data.record.demographics %}demographics, {% endif %}{% if consent_data.record.contact %}contact information, {% endif %}{% if consent_data.record.screenrecoding %}the screen and/or activities on your device, {% endif %}{% if consent_data.record.interaction %}your interactions, {% endif %}and browser meta data during the online study. Any data collected during this study will only be published in anonymized form. This site uses cookies and other tracking technologies to conduct the research, to improve the user experience, the ability to interact with the system and to provide additional content from third parties. Despite careful control of content, the researchers assume no liability for damages, which directly or indirectly result from the use of this online application.</p>
    
    <p>Your non-anonymized data will be stored for {{ storage_time }} from the time your consent is given, unless you withdraw your consent before this period has elapsed. Your non-anonymized data will be stored in a secure location and will be accessible only to the researchers involved in this work.</p>
    
    <p>The data collected cannot be viewed or used for further research by everyone outside the researchers involved in this work. The data collected will be deleted after the end of the research, or if you contact the researcher to delete them.</p>

    <p>As with any publication or online-related activity, the risk of a breach of confidentiality is always possible. According to the GDPR, the researchers will inform the participant if a breach of confidential data is detected.</p>
    
    <p>By participating in this study you agree with the <a href="https://github.com/customer-terms/github-copilot-product-specific-terms">Terms and Conditions of GitHub Copilot</a>.</p>

    <h2>6. Identification of Investigators</h2>
    <p>If you have any questions or concerns about the research, please feel free to contact:</p>
    
    <div class="researchers">
        {% for researcher in researchers %}
        <p>{{ researcher.name }} ({{ researcher.email }})</p>
        {% endfor %}
        <p><strong>{{ pi_name }}</strong><br>
        Principal Investigator<br>
        Frauenlobstr 7a<br>
        80337 Munich, Germany<br>
        {{ pi_email }}</p>
    </div>
    
    <h2>7. Informed Consent and Agreement</h2>
    <p>This consent form will be retained securely and in compliance with the GDPR for no longer than necessary.</p>
    
    <form method="POST" action="{{ url_for('consent') }}">
        <div class="consent-checkbox">
            <label>
                <input type="checkbox" id="understanding-check" name="understanding">
                I understand the explanation provided to me. I have been given a copy of this form. I have had all my questions answered to my satisfaction, and I voluntarily agree to participate in this online study.
            </label>
        </div>
        
        <div class="consent-checkbox">
            <label>
                <input type="checkbox" id="data-consent-check" name="data_consent">
                I voluntarily consent to my data being recorded and subsequently processed in line with the GDPR. I have been informed about the consequences of withdrawing my consent.
            </label>
        </div>
        
        <button type="submit" class="consent-btn" id="continue-btn">Continue Without Consent</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const understandingCheck = document.getElementById('understanding-check');
    const dataConsentCheck = document.getElementById('data-consent-check');
    const button = document.getElementById('continue-btn');
    
    function updateButtonState() {
        const bothChecked = understandingCheck.checked && dataConsentCheck.checked;
        
        if (bothChecked) {
            button.textContent = 'Continue to Study';
            button.disabled = false;
        } else {
            button.textContent = 'Continue Without Consent';
            button.disabled = false;
        }
    }
    
    // Initially set button state
    updateButtonState();
    
    // Update button state when checkboxes change
    understandingCheck.addEventListener('change', updateButtonState);
    dataConsentCheck.addEventListener('change', updateButtonState);
});
</script>
{% endblock %}
